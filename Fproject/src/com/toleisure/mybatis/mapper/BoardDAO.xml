<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.toleisure.mybatis.dao.IBoardDAO">
	 
 <resultMap id="BoardDTO" type="com.toleisure.mybatis.dto.BoardDTO">
        <result property="rNum" column="rNum"/>
        <result property="boardNum" column="boardNum"/>
        <result property="boardTitle" column="boardTitle"/>
        <result property="boardCont" column="boardCont"/>
        <result property="boardDate" column="boardDate"/>
        <result property="boardMem" column="boardMem"/>
        <result property="boardHits" column="boardHits"/>
    </resultMap> 
    
  <!-- <resultMap id="BoardDTO" type="com.toleisure.mybatis.dto.BoardDTO">  resultMap id는 하나밖에못씀
        <result property="faqNum" column="faqNum"/>
        <result property="faqTitle" column="faqTitle"/>
        <result property="faqCont" column="faqCont"/>
        <result property="faqDate" column="faqDate"/>
        <result property="faqMem" column="faqMem"/>
    </resultMap> -->
    

	 
<!-- 	
	
	<select id="news" resultType="com.toleisure.mybatis.dto.BoardDTO">
		SELECT NEWS_NUM AS newsNum, MEM_NAME AS memName
			 , NEWS_TITLE AS newsTitle, NEWS_CONT AS newsCont, SUBSTR(NEWS_DATE, 1, 10) AS newsDate, NVL(NEWS_HITS, 0)AS newsHits
		FROM NEWS_POST_VIEW
	</select>
	
	
	
	<select id="faq" resultType="com.toleisure.mybatis.dto.BoardDTO">
		SELECT FAQ_NUM AS faqNum, FAQ_TITLE AS faqTitle, FAQ_CONT AS faqCont, FAQ_DATE AS faqDate
		FROM FAQ_POST_VIEW
	</select> -->

<!-- 	<select id="getfaqMaxNum" resultType="com.toleisure.mybatis.dto.BoardDTO">
		SELECT NVL(MAX(NUM), 0) AS MAXNUM 
		FROM FAQ_POST_VIEW
	</select>
	
	<select id="getfaqReadData" resultType="com.toleisure.mybatis.dto.BoardDTO">
		SELECT FAQ_NUM AS faqNum, FAQ_TITLE AS faqTitle, FAQ_CONT AS faqCont, FAQ_DATE AS faqDate
        FROM FAQ_POST_VIEW
        WHERE FAQ_NUM=#{faqNum}
	</select>
	
	
	<select id="comMaxNum" resultType="com.toleisure.mybatis.dto.BoardDTO">
		SELECT NVL(MAX(NUM), 0) AS MAXNUM 
		FROM FAQ_POST_VIEW
	</select>
	
	<select id="getcomReadData" resultType="com.toleisure.mybatis.dto.BoardDTO">
		SELECT FAQ_NUM AS faqNum, FAQ_TITLE AS faqTitle, FAQ_CONT AS faqCont, FAQ_DATE AS faqDate
        FROM FAQ_POST_VIEW
        WHERE FAQ_NUM=#{faqNum}
	</select> -->
<!-- 	<select id="noticeList" resultType="com.toleisure.mybatis.dto.BoardDTO">
		SELECT EVENT_NUM AS eventNum, MEM_NAME AS memName, EVENT_TITLE AS eventTitle,
			   EVENT_CONT AS eventCont, EVENT_DATE AS eventDate, NVL(EVENT_HITS, 0) AS eventHits
      				( SELECT ROWNUM RNUM, DATA.* 
      				  FROM 
	      				( 
	      				SELECT EVENT_NUM, MEM_NAME, EVENT_TITLE, EVENT_HITS, EVENT_DATE, EVENT_CONT
	      				FROM EVENT_POST_VIEW 
	      				ORDER BY EVENT_NUM DESC 
	      				) DATA 
      				) WHERE RNUM >= #{start} AND #{end} >=RNUM
		
	</select> -->

    
   <!--  <sql id="search">
    <if test="searchType != null">
        <if test="searchType=='t'.toString()">
            and title like CONCAT('%',#{keyword},'%')
        </if>
        
        <if test="searchType=='c'.toString()">
            and content like CONCAT('%',#{keyword},'%')
        </if>
        
        <if test="searchType=='w'.toString()">
            and writer like CONCAT('%',#{keyword},'%')
        </if>
        
        <if test="searchType=='tc'.toString()">
            and (title like CONCAT('%',#{keyword},'%') OR content like CONCAT('%',#{keyword},'%'))
        </if>
        
        <if test="searchType=='cw'.toString()">
            and (content like CONCAT('%',#{keyword},'%') OR writer like CONCAT('%',#{keyword},'%'))
        </if>
        
        <if test="searchType=='tcw'.toString()">
            and (title like CONCAT('%',#{keyword},'%') OR 
                content like CONCAT('%',#{keyword},'%') OR 
                writer like CONCAT('%',#{keyword},'%'))
        </if>
    </if>    
    </sql>     -->
     <select id="newsListCount" resultType="Integer">
        SELECT COUNT(*)
        FROM NEWS_POST_VIEW
    </select>
    
     <select id="newsList" resultMap = "BoardDTO">
		SELECT  E.NUM AS rNum,E.NEWS_NUM AS boardNum, E.NEWS_TITLE AS boardTitle, E.NEWS_CONT AS boardCont
        		,E.NEWS_DATE AS boardDate,E.MEM_NAME AS boardMem, E.NEWS_HITS AS boardHits
        			FROM
      				( 
      				  SELECT ROW_NUMBER() OVER (ORDER BY DATA.NEWS_NUM DESC) NUM, DATA.* 
      				  FROM 
	      				( 
	      				SELECT NEWS_NUM, MEM_NAME, NEWS_TITLE, NEWS_DATE, NEWS_CONT,NEWS_HITS
	      				FROM NEWS_POST_VIEW 
	      				ORDER BY NEWS_NUM DESC 
	      				) DATA 
      				)E 
      				WHERE NUM BETWEEN #{startIndex} AND #{endIndex}
      </select>
    
    <select id="eventListCount" resultType="Integer">
        SELECT COUNT(*)
        FROM EVENT_POST_VIEW
    </select>
    
     <select id="eventList" resultMap = "BoardDTO">
		SELECT  E.NUM AS rNum,E.EVENT_NUM AS boardNum, E.EVENT_TITLE AS boardTitle, E.EVENT_CONT AS boardCont
        		,E.EVENT_DATE AS boardDate,E.MEM_NAME AS boardMem , E.EVENT_HITS AS boardHits
        			FROM
      				( 
      				  SELECT ROW_NUMBER() OVER (ORDER BY DATA.EVENT_NUM DESC) NUM, DATA.* 
      				  FROM 
	      				( 
	      				SELECT EVENT_NUM, MEM_NAME, EVENT_TITLE, EVENT_HITS, EVENT_DATE, EVENT_CONT
	      				FROM EVENT_POST_VIEW 
	      				ORDER BY EVENT_NUM DESC 
	      				) DATA 
      				)E 
      				WHERE NUM BETWEEN #{startIndex} AND #{endIndex}
      </select>

   
    <select id="faqListCount" resultType="Integer">
        SELECT COUNT(*)
        FROM FAQ_POST_VIEW
    </select>
    
     <select id="faqList" resultMap = "BoardDTO">
		SELECT  E.FAQ_NUM AS boardNum, E.FAQ_TITLE AS boardTitle, E.FAQ_CONT AS boardCont
        		,E.FAQ_DATE AS boardDate,E.MEM_NAME AS boardMem
        			FROM
      				( 
      				  SELECT ROWNUM RNUM, DATA.* 
      				  FROM 
	      				( 
	      				SELECT FAQ_NUM, MEM_NAME, FAQ_TITLE, FAQ_DATE, FAQ_CONT
	      				FROM FAQ_POST_VIEW 
	      				ORDER BY FAQ_NUM DESC 
	      				) DATA 
      				)E 
      </select>
<!--    parameterType="String"  -->
     <select id="eventSelect" resultMap ="BoardDTO">
        SELECT  EVENT_NUM AS boardNum, EVENT_TITLE AS boardTitle, EVENT_CONT AS boardCont,
        		EVENT_DATE AS boardDate,MEM_NAME AS boardMem, EVENT_HITS AS boardHits
        FROM EVENT_POST_VIEW
        WHERE EVENT_NUM = #{boardNum}
    </select>
    
    
    <select id="newsSelect" resultMap ="BoardDTO">
        SELECT  NEWS_NUM AS boardNum, NEWS_TITLE AS boardTitle, NEWS_CONT AS boardCont,
        		NEWS_DATE AS boardDate,MEM_NAME AS boardMem, NEWS_HITS AS boardHits
        FROM NEWS_POST_VIEW
        WHERE NEWS_NUM = #{boardNum}
    </select>
    
   <delete id="newsDelete" >
        DELETE 
        FROM NEWS
        WHERE NEWS_NUM = #{boardNum}
    </delete>
    
    <delete id="eventDelete" >
        DELETE 
        FROM EVENT
        WHERE EVENT_NUM = #{boardNum}
    </delete>
    
    
    
    
    <insert parameterType="com.toleisure.mybatis.dto.BoardDTO" id="eventInsert">
      {CALL
         DECLARE
            boardCodeSeq INT;
         BEGIN
            boardCodeSeq := EVENTSEQ.NEXTVAL;
  
             INSERT INTO EVENT(EVENT_NUM,ADMIN_CODE,EVENT_TITLE,EVENT_CONT,EVENT_DATE,EVENT_HITS)
            VALUES(boardCodeSeq,1, #{boardTitle}, #{boardCont} ,SYSDATE,0);
            
            <choose>
               <when test='check!= 0'>
                  INSERT INTO EVENT_NOTICE
                     (ENOTICE_NUM, EVENT_NUM,ADMIN_CODE)
                  VALUES
                     (EVENT_NOTSEQ.NEXTVAL,boardCodeSeq,1);
               </when>
               <otherwise>
                 
               </otherwise>
            </choose>
      END
      }
   </insert>
   
   
    <insert parameterType="com.toleisure.mybatis.dto.BoardDTO" id="newsInsert">
      {CALL
         DECLARE
            boardCodeSeq INT;
         BEGIN
            boardCodeSeq := NEWSSEQ.NEXTVAL;
  
             INSERT INTO NEWS(NEWS_NUM,ADMIN_CODE,NEWS_TITLE,NEWS_CONT,NEWS_DATE,NEWS_HITS)
            VALUES(boardCodeSeq,1, #{boardTitle}, #{boardCont} ,SYSDATE,0);
            
            <choose>
               <when test='check!= 0'>
                  INSERT INTO NEWS_NOTICE
                     (NNOTICE_NUM, NEWS_NUM,ADMIN_CODE)
                  VALUES
                     (NEWS_NOTSEQ.NEXTVAL,boardCodeSeq,1);
               </when>
               <otherwise>
                 
               </otherwise>
            </choose>
      END
      }
   </insert>
   
   
   <insert parameterType="com.toleisure.mybatis.dto.BoardDTO" id="faqInsert">
        INSERT INTO FAQ(FAQ_NUM,ADMIN_CODE,FAQ_TITLE,FAQ_CONT,FAQ_DATE)
            VALUES(FAQSEQ.NEXTVAL,1, #{boardTitle}, #{boardCont} ,SYSDATE);
   </insert>
   
   
   <update id ="updateNewsHitCount" parameterType="Integer">
   			UPDATE NEWS
   			SET NEWS_HITS = NEWS_HITS+1
   			WHERE NEWS_NUM =#{boardNum}
   </update>
   
    <update id ="updateEventHitCount" parameterType="Integer">
   			UPDATE EVENT
   			SET EVENT_HITS = EVENT_HITS+1
   			WHERE EVENT_NUM =#{boardNum}
   </update>
   
   
   
 <!--    <insert id="noticeInsert" parameterType="com.toleisure.mybatis.dto.BoardDTO">
        insert into push_notice
        (
            notice_title,
            notice_coments,
            mod_date
        )
        values
        (
            #{notice_title},
            #{notice_coments},
            NOW()
        )
    </insert> -->
    
    
    
   <!--  <update id="noticeUpdate" parameterType="com.spring.test.vo.NoticeVo">
        update push_notice set
            notice_title = #{notice_title},
            notice_coments = #{notice_coments},
            mod_date = NOW()
        where notice_id = #{notice_id}
    </update> -->
    
</mapper>